<div class="product-form-container">
  <!-- Header -->
  <mat-toolbar class="page-header">
    <mat-toolbar-row>
      <button mat-icon-button (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <span class="page-title">
        <mat-icon>{{ isEditMode ? 'edit' : 'add' }}</mat-icon>
        {{ pageTitle }}
      </span>
    </mat-toolbar-row>
  </mat-toolbar>

  <!-- Loading -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
    <p>Cargando producto...</p>
  </div>

  <!-- Form -->
  <mat-card class="form-card" *ngIf="!isLoading">
    <mat-card-header>
      <mat-card-title>
        {{ isEditMode ? 'Información del Producto' : 'Nuevo Producto' }}
      </mat-card-title>
      <mat-card-subtitle>
        {{ isEditMode ? 'Modifica los datos del producto' : 'Completa la información del producto' }}
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="product-form">

        <!-- Nombre -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nombre del producto *</mat-label>
          <input matInput
                 formControlName="name"
                 placeholder="Ej: iPhone 15 Pro"
                 maxlength="200">
          <mat-hint>Máximo 200 caracteres</mat-hint>
          <mat-error>{{ getErrorMessage('name') }}</mat-error>
        </mat-form-field>

        <!-- SKU -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>SKU *</mat-label>
          <input matInput
                 formControlName="sku"
                 placeholder="Ej: IP15P-128-BLK"
                 maxlength="50">
          <mat-hint>Código único del producto</mat-hint>
          <mat-error>{{ getErrorMessage('sku') }}</mat-error>
        </mat-form-field>

        <!-- Marca y Categoría en fila -->
        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Marca</mat-label>
            <input matInput
                   formControlName="brand"
                   placeholder="Ej: Apple"
                   maxlength="100">
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Categoría *</mat-label>
            <mat-select formControlName="categoryId">
              <mat-option value="">Selecciona una categoría</mat-option>
              <mat-option *ngFor="let category of categories" [value]="category.id">
                {{ category.name }}
              </mat-option>
            </mat-select>
            <mat-error>{{ getErrorMessage('categoryId') }}</mat-error>
          </mat-form-field>
        </div>

        <!-- Descripción -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Descripción</mat-label>
          <textarea matInput
                    formControlName="description"
                    placeholder="Describe las características principales del producto"
                    rows="3"></textarea>
          <mat-hint>Información adicional sobre el producto</mat-hint>
        </mat-form-field>

        <!-- URL de imagen -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>URL de imagen</mat-label>
          <input matInput
                 formControlName="imageUrl"
                 placeholder="https://ejemplo.com/imagen.jpg"
                 maxlength="500">
          <mat-hint>Enlace a la imagen del producto</mat-hint>
          <mat-error>{{ getErrorMessage('imageUrl') }}</mat-error>
        </mat-form-field>

        <!-- Estado (solo en edición) -->
        <div class="form-row" *ngIf="isEditMode">
          <mat-slide-toggle formControlName="isActive" class="status-toggle">
            <span class="toggle-label">
              Producto {{ productForm.get('isActive')?.value ? 'activo' : 'inactivo' }}
            </span>
          </mat-slide-toggle>
        </div>

        <!-- Vista previa de imagen -->
        <!-- <div class="image-preview" *ngIf="productForm.get('imageUrl')?.value">
          <h4>Vista previa de imagen:</h4>
          <img [src]="productForm.get('imageUrl')?.value"
               alt="Vista previa"
               (error)="($event.target as HTMLImageElement).style.display='none'"
               (load)="($event.target as HTMLImageElement).style.display='block'">
        </div> -->

      </form>
    </mat-card-content>

    <mat-card-actions class="form-actions">
      <div class="actions-container">
        <button mat-stroked-button
                type="button"
                (click)="goBack()"
                [disabled]="isSaving">
          <mat-icon>cancel</mat-icon>
          Cancelar
        </button>

        <button mat-raised-button
                color="primary"
                type="submit"
                [disabled]="productForm.invalid || isSaving"
                (click)="onSubmit()">
          <mat-icon *ngIf="!isSaving">{{ isEditMode ? 'save' : 'add' }}</mat-icon>
          <mat-progress-spinner *ngIf="isSaving"
                                diameter="20"
                                mode="indeterminate">
          </mat-progress-spinner>
          {{ submitButtonText }}
        </button>
      </div>
    </mat-card-actions>
  </mat-card>
</div>
